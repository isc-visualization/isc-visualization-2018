<!DOCTYPE html>
<html lang="kr">

<head>
  <meta charset="utf-8">
  <title>D3 페이지 템플릿</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
  </style>
</head>

<body>
  <svg>
    <path d="M10 10 h 80 v 80 h -80 " fill="transparent" stroke="blue" stroke-width:"10px"/>
  </svg>
  <script type="text/javascript">
    var data = [{
        "category": "B",
        "sub_category": "B1",
        "position": 0,
        "value": 0.7
      },
      {
        "category": "B",
        "sub_category": "B1",
        "position": 1,
        "value": 0.2
      },
      {
        "category": "B",
        "sub_category": "B1",
        "position": 2,
        "value": 1.1
      },
      {
        "category": "B",
        "sub_category": "B1",
        "position": 3,
        "value": 0.8
      },
      {
        "category": "A",
        "sub_category": "A1",
        "position": 0,
        "value": 0.1
      },
      {
        "category": "A",
        "sub_category": "A1",
        "position": 1,
        "value": 0.6
      },
      {
        "category": "A",
        "sub_category": "A1",
        "position": 2,
        "value": 0.9
      },
      {
        "category": "A",
        "sub_category": "A1",
        "position": 3,
        "value": 0.4
      },
      {
        "category": "C",
        "sub_category": "C1",
        "position": 0,
        "value": 0.6
      },
      {
        "category": "C",
        "sub_category": "C1",
        "position": 1,
        "value": 0.1
      },
      {
        "category": "C",
        "sub_category": "C1",
        "position": 2,
        "value": 0.2
      },
      {
        "category": "C",
        "sub_category": "C1",
        "position": 3,
        "value": 0.7
      },
      {
        "category": "C",
        "sub_category": "C2",
        "position": 0,
        "value": 0.3
      },
      {
        "category": "C",
        "sub_category": "C2",
        "position": 1,
        "value": 0.4
      },
      {
        "category": "C",
        "sub_category": "C2",
        "position": 2,
        "value": 1.1
      },
      {
        "category": "C",
        "sub_category": "C2",
        "position": 3,
        "value": 0.8
      },
      {
        "category": "A",
        "sub_category": "A2",
        "position": 0,
        "value": 0.2
      },
      {
        "category": "A",
        "sub_category": "A2",
        "position": 1,
        "value": 0.4
      },
      {
        "category": "A",
        "sub_category": "A2",
        "position": 2,
        "value": 0.6
      },
      {
        "category": "A",
        "sub_category": "A2",
        "position": 3,
        "value": 0.4
      },
      {
        "category": "B",
        "sub_category": "B2",
        "position": 0,
        "value": 0.1
      },
      {
        "category": "B",
        "sub_category": "B2",
        "position": 1,
        "value": 0.3
      },
      {
        "category": "B",
        "sub_category": "B2",
        "position": 2,
        "value": 1.2
      },
      {
        "category": "B",
        "sub_category": "B2",
        "position": 3,
        "value": 0.1
      }
    ]


    console.log(data);
    var entries = d3.nest()
      .key(function (d) {
        return d.category
      })
      .key(function(d) {
        return d.sub_category;
      })
      .rollup(function(values) {
        return {
          count:values.length,
          sum:d3.sum(values, function(d){return d.value}
        )};
      })
      .object(data);
    
    console.log(entries);
  </script>
</body>

</html>